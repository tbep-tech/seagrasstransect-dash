---
title: "TAMPA BAY SEAGRASS TRANSECT DASHBOARD"
output: 
  flexdashboard::flex_dashboard:
     logo: www/tarponlogo.png
     social: menu
     source_code: "https://github.com/tbep-tech/seagrasstransect-dash"
runtime: shiny
css: styles.css
---

```{r setup, include=F}
knitr::opts_chunk$set(echo = F, message = F, warning = F)

library(flexdashboard)
library(tidyverse)
library(tbeptools)
# devtools::load_all('../tbeptools')
library(mapview)
library(sf)
library(reactable)
library(shinydashboard)
library(plotly)
library(shinyWidgets)
library(extrafont)

# # style file
# styles <- readLines('https://raw.githubusercontent.com/tbep-tech/css-styling/master/styles.css')
# writeLines(styles, 'styles.css')

data(transect)
data(transectocc)

fml <- 'Lato Light'

# for shiny server
st_crs(trnlns) <- 4326
st_crs(trnpts) <- 4326

# globals
segs <- c('OTB', 'HB', 'MTB', 'LTB', 'BCB')
spp <- c("Halodule", "Syringodium", "Thalassia", "Halophila", "Ruppia", "Caulerpa")
```

```{r reactives}
# matrix plot
matplo <- reactive({
  
  # input
  segsel1 <- input$segsel1
  yrssel1 <- input$yrssel1

  req(!is.null(segsel1))
  req(yrssel1[1] < yrssel1[2])
  
  p <- show_transectmatrix(transectocc, bay_segment = segsel1, plotly = T, family = fml, yrrng = yrssel1)
  
  return(p)
  
})

# ave freq occurrence plot
aveplo <- reactive({
  
  # input
  segsel1 <- input$segsel1
  sppsel1 <- input$sppsel1
  yrssel1 <- input$yrssel1
  
  req(!is.null(segsel1))
  req(!is.null(sppsel1))
  req(yrssel1[1] < yrssel1[2])
  
  p <- show_transectavespp(transectocc, bay_segment = segsel1, species = sppsel1, plotly = T, family = fml, yrrng = yrssel1) %>% 
    layout(
      title = list(text = NA)
    )
  
  return(p)
  
})
```

OVERVIEW
===========================================================

Column {.tabset .tabset-fade data-width=650}
-----------------------------------------------------------------------

### USING THE DASHBOARD

<div class = "row">
<div class = "col-md-2"></div>
<div class = "col-md-8">

#### WELCOME TO THE TAMPA BAY SEAGRASS TRANSECT DASHBOARD!

```{r, echo = F, out.width = '100%', fig.align = 'center'}
knitr::include_graphics('www/bannerimage.png')
```

1) __TRANSECT LOCATIONS__
1) __OVERALL SUMMARIES__
1) __SELECTED TRANSECT DATA__

Some of the plots in this dashboard are interactive and display options can be controlled using a mouse. Most plots include a [control menu](https://help.plot.ly/zoom-pan-hover-controls/) on the top with different options for viewing the data.  For example, click the camera icon to download a png file for a plot.

<br>
```{r, fig.align='center', out.width='30%'}
knitr::include_graphics('www/plotcontrols.PNG')
```
<br>

#### Website information

Technical questions about the TBNI can be sent to [Gary Raulerson](mailto:graulserson@tbep.org).  Questions and comments about the dashboard can be sent to [Marcus Beck](mailto:mbeck@tbep.org). The page source content can be viewed on [Github](https://github.com/tbep-tech/seagrasstransect-dash). Like this app? Share it on social media using the [\#TampaBayOpenSci](https://twitter.com/hashtag/TampaBayOpenSci?src=hashtag_click) hashtag.  

Citation info here: forthcoming

</div>
<div class = "col-md-2"></div>
</div>

1 TRANSECT LOCATIONS
===========================================================

Column
-----------------------------------------------------------------------

### STARTING LOCATIONS, DIRECTION, AND AGENCY

```{r}
mapview(trnpts, label = trnpts$lab, zcol = 'MonAgency', lwd = 0, legend = F, homebutton = F) + 
  mapview(trnlns, zcol = 'MonAgency', homebutton = F, layer.name = 'Monitoring Agency', lwd = 4)
```

2 OVERALL SUMMARIES
===========================================================

Row
-----------------------------------------------------------------------

### REPORT CARD MATRIX AND FREQUENCY OCCURRENCE OVER TIME

```{r}
fillCol(flex = c(0.1, 1),
  fillRow(
    selectInput(inputId = 'segsel1', label = 'Select segments:', choices = segs, selected = segs, selectize  = T, multiple = T, width = '90%'),
    selectInput(inputId = 'sppsel1', label = 'Select species:', choices = spp, selected = spp, selectize = T, multiple = T, width = '90%'), 
    sliderInput(inputId = 'yrssel1', label = 'Select year range:', min = 1998, max = 2019, value = c(1998, 2019), step = 1, sep = '', width = '90%')
  ),
  fillRow(flex = c(0.5, 1),
    renderPlotly(matplo()),
    renderPlotly(aveplo())
  )
)
```

2 SELECTED TRANSECT DATA
===========================================================

Column {.tabset .tabset-fade data-width=275}
-----------------------------------------------------------------------

Column {data-width=500}
--------------------------

